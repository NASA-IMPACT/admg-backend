{% extends "api_app/base.html" %}
{% load change_extras crispy_forms_tags static %}

{% block extrahead %}
{{ block.super }}
{{ form.media }}
{{ model_form.media }}
{% endblock %}

{% block page %}
  <form method="post">
    {% csrf_token %}
    {% for field in form %} {{ field.as_hidden }} {% endfor %}
    <div class="row">
      {# Main Content #}
      <div class="col-8">
        <h3>{{ object.get_action_display }} {{ object.model_name }}: {{ object.update.short_name | default:object.uuid }}</h3>
        <table class="table table-responsive">
          {{ model_form | crispy }}
        </table>
      </div>

    {# Sidebar #}
    <div class="col-4">

      <h3>Actions</h3>
      <button class="btn btn-success">Save</button>

      <h3>Related Data</h3>
      {% related_changes change %}

      <hr />

      <h3>History</h3>
      {% related_approval_logs approvals %}

      <hr />

      <h3>Raw Data</h3>
      <code>{{ object.update | pprint }}</code>

    </div>
  </div>
</form>

{% endblock %}

{% block javascript %}
{{ block.super }}
<script>
  // Mark all required inputs as not-required (but store required as data-required attribute)
  ['input', 'textarea', 'select'].forEach(function (value) {
    $(value + '[required]')
      .attr('data-required', true)
      .attr('required', false);
  })
</script>
{% endblock %}